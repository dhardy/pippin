#0020 State identifiers
==============

What should we do when commit statesums clash?

Possible exploit: someone forks the repo, creates a new state
decending from an ancestor of commit X but with checksum
collision against X, pushes it back to the local repo and thus
rewrites history. Okay, this involves being able to forge SHA256
hash collisions *and* get your target to pull your changes.

More likely case: two commits are made which reach the same
state and thus have the same sum. One gets ignored. Maybe okay?

Possible bug: a commit reverts to the previous state, thus its
sum collides with that of an ancestor commit. This could be
problematic!


Possible solutions
---------------

Make each commit somehow mutate the state in a way that can't
be reversed. This avoids the revert-to-previous-state issue (if that is indeed
an issue), but not checksum-collision.

Do nothing. Does collision matter in the case of a revert? What happens in the
case of an accidental collision? Intentional collision is not really possible
with secure checksums.

Add a "comment" field to commits, or a per-partition "commit number" element or
some such. Include the value of this in the checksum. If the checksum clashes,
mutate it. This leaves two problems: (1) given a commit to merge in with
clashing sum, do we ignore it or mutate the sum and merge it, and (2) are there
other exploits or issues involving sum clashes we can't (currently) spot?


Plan
------

Make a variant of `PartitionState` which can be used to construct a commit.

Disallow pushing a "state" to a `Partition` (commits must be made).

Add a pseudo-element storing some metadata, including the parent(s)'
state-sums. This will be replaced by every commit. Thus the state-sum of a "no
changes" commit cannot equal its parent's sum.
Requirements: a commit must actively be made from a parent
state, rather than simply pushing an altered state.

Metadata:

*   commit number (optional, convenient identifier like Mercurial provides)
*   commit timestamp (optional, informative)
*   commit author (optional, informative)
*   primary parent's id (required)
*   other parents' ids (important)

Derived: checksum of pseudo-element (needed at creation, when commit is patched
onto the parent state, when creating a child commit, when patcing a child
commit).

Simpler alternative: do not construct a pseudo-element and its sum, instead
just use the parent's sum in the permutation calculation.
